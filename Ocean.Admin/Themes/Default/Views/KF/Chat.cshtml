@{
    Layout = null;
}
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>客服专员</title>
    <link rel="stylesheet" type="text/css" href="@Url.Content("~/Content/jquery-easyui-1.3.5/themes/icon.css")" />
    <link rel="stylesheet" type="text/css" href="@Url.Content("~/Content/jquery-easyui-1.3.5/themes/default/easyui.css")" />
    <script type="text/javascript" src="@Url.Content("~/Content/jquery-easyui-1.3.5/jquery.min.js")"></script>
    <script type="text/javascript" src="@Url.Content("~/Content/jquery-easyui-1.3.5/jquery.easyui.min.js")"></script>
    <script type="text/javascript" src="@Url.Content("~/Content/jquery-easyui-1.3.5/locale/easyui-lang-zh_CN.js")"></script>
    <script type="text/javascript" src="@Url.Content("~/Content/jquery-easyui-1.3.5/format.date.js")"></script>
    <link href="@Url.Content("~/Content/KF/images/index.css")" rel="stylesheet" type="text/css" />
    <script src="@Url.Content("~/Content/KF/javascripts/common.js")" type="text/javascript"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            resize();
            $('#w').window('close');
            $('#w2').window('close');
        });
        function ShowDialog() {
            if (Oclient.TalkMeetingKey) {
                $('#iframe').attr("src", "/KF/KfMeetingMessageList?MpUserId=" + Oclient.TalkMeetingKey);
                $('#w').window('open');
            } else {
                $.messager.alert('提示', '请选择要查看的会话');
            }
        }
        function ShowDialog2() {
            if (Oclient.TalkMeetingKey) {
                $('#iframe2').attr("src", "/Loan?MpUserId=" + Oclient.TalkMeetingKey);
                $('#w2').window('open');
            } else {
                $.messager.alert('提示', '请选择要查看的会话');
            }
        }
        function ShowDialog3() {
            if (Oclient.TalkMeetingKey) {
                $('#iframe3').attr("src", "/funongbao/Apply?MpUserId=" + Oclient.TalkMeetingKey);
                $('#w3').window('open');
            } else {
                $.messager.alert('提示', '请选择要查看的会话');
            }
        }
    </script>
    <style type="text/css">
        .style1
        {
            position: absolute;
            left: 161px;
            top: 6px;
            height: 26px;
            line-height: 26px;
            color: #3D5B96;
            font-weight: bold;
            text-indent: 10px;
            z-index: 1;
            width: 1199px;
            border-left: 1px solid #B6C5E0;
            border-right: 1px solid #B6C5E0;
            background: url( '@Url.Content("~/Content/KF/images/talk_title.gif")' );
        }
    </style>
</head>
<body scroll="no" style="background: #e1e1e1;">
    <bgsound id="sound">
    <div id="zDiv" style="background-color: #333; opacity: 0.5; filter: alpha(opacity=10);
        position: absolute; z-index: 17; top: 0px; left: 0px; display: none; width: 100%;">
    </div>
    <div id="loading" style="display: none; z-index: 200; width: 200px; height: 30px;
        position: absolute; left: 10px; top: 10px; font-size: 12px;">
        <img src="@Url.Content("~/Content/KF/images/loading.gif")" alt="页面加载中，请等待..." />
    </div>
    <div id="header">
        <div id="h_logo">
            <a href="#" target="_blank">
                <div id="logo" style="background: url(@Url.Content("~/Content/KF/images/logo_cn.gif")) 14px 6px no-repeat;">
                    v1.0
                </div>
            </a>
            <div class="bulletin" id="bulletin" style="width: 866px;">
            </div>
            <div id="p_manage" style="left: 1220px; display:none;">
                <div id="manage_menu" onmouseover="javascript:void(0);" onmouseout="javascript:void(0);">
                    <a href="#" target="_blank">管理中心</a></div>
                  <div id="p_info">
                   <a href="#"
                        target="_blank">个人设置</a>
                </div>
            </div>
            <div id="state" style="left: 1239px; display:block;">
                @if (ViewBag.OnlineStatus == 0) 
                { 
                <div id="state_on" style="display: block;">
                    <img id="state_1" name="state_1" src="@Url.Content("~/Content/KF/images/state_online.gif")" width="16" height="18"></div>
                <div id="state_off" style="display: none;">
                    <img id="state_1" name="state_1" src="@Url.Content("~/Content/KF/images/state_offline.gif")" width="16" height="18"></div>
                <div id="state_machine" style="display: none;">
                    <img id="state_1" name="state_1" src="@Url.Content("~/Content/KF/images/state_machine.gif")" width="16" height="18"></div>
                <div id="state_set" onmouseover="$('#state_list').show();" onmouseout="$('#state_list').hide();">
                    <a>在线</a></div>
                }
                else if (ViewBag.OnlineStatus == 1)
                { 
                <div id="state_on" style="display: none;">
                    <img id="state_1" name="state_1" src="@Url.Content("~/Content/KF/images/state_online.gif")" width="16" height="18"></div>
                <div id="state_off" style="display: block;">
                    <img id="state_1" name="state_1" src="@Url.Content("~/Content/KF/images/state_offline.gif")" width="16" height="18"></div>
                <div id="state_machine" style="display: none;">
                    <img id="state_1" name="state_1" src="@Url.Content("~/Content/KF/images/state_machine.gif")" width="16" height="18"></div>
                <div id="state_set" onmouseover="$('#state_list').show();" onmouseout="$('#state_list').hide();">
                    <a>离开</a></div>
                }
                <div id="logout">
                    <a href="javascript:void(0);" onclick="window.close();">退出</a></div>
            </div>
        </div>
    </div>
    <!--状态列表-->
    <div id="state_list" style="display: none; left: 1239px;" onmouseout="$('#state_list').hide();"
        onmouseover="$('#state_list').show()">
        <h3 style="cursor: pointer;">
        </h3>
        <div id="state_online" class="state_1" title="点击将状态设置为在线" onclick="javascript:void(0);">
            <a href="javascript:void(0);" onclick="Oclient.SetOnlineStatus(0);">在线</a></div>
        <div id="state_offline" class="state_2" title="点击将状态设置为离开" onclick="javascript:void(0);">
            <a href="javascript:void(0);" onclick="Oclient.SetOnlineStatus(1);">离开</a></div>
        <!--<div class="state_3" title="点击将状态设置为机器人托管" onclick="try{if('0'==0) {alert('您尚未开通高级功能【智能机器人】，无法使用托管状态');document.getElementById('state_set').style.display='none';}else{if(g_start==1) sendSTE(3,this)}}catch(e){}"><a href="#">托管</a></div>-->
    </div>
    <!--manage menu -->
    <div id="manage_list" style="visibility: hidden; left: 1076px;">
        <h3 style="cursor: pointer;">
            管理中心</h3>
    </div>
    <div id="body" style="height: 566px;">
        <div id="nav">
            <div id="nav_left">
                <ul>
                    <li id="stab_1" class="on" title="切换到访客对话界面"><a href="javascript:void(0)" hidefocus="">
                        <span id="tab_talk">访客对话</span></a> </li>
                    <li id="stab_3" title="切换到等待咨询界面"><a href="javascript:void(0);" hidefocus="">等待咨询</a>
                    </li>
                </ul>
            </div>
            <div id="nav_right" class="link_g" style="left: 1006px;">
                <div style="float: right; width: 80px;">
                </div>
                <div style="float: right; width: 90px;">
                </div>
                <a href="javascript:void(0)" style="float: right; width: 107px;" onclick="javascript:void(0);"
                    title="咨询我的客户经理" id="is_pay_user_no">
                    <!---->
                </a>
            </div>
            <div class="clear">
            </div>
        </div>
        <div id="part_1">
            <div class="block">
                <div id="list" style="height: 515px;">
                    <h3 id="kh_count">
                        当前共有0个对话</h3>
                    <ul id="client_content" style="height: 485px;">
                        <!--动态创建<li>-->
                        @*<li id="visitor_gid" style="cursor: pointer;">
                            <div id="name_gid" class="fklist_left">
                                nick</div>
                            <div class="fklist_right">
                            </div>
                            <div class="clear">
                            </div>
                        </li>*@
                    </ul>
                </div>
                <div id="talk_title" class="style1">
                    <div class="t_left">
                        欢迎使用客服系统，当前聊天对象&nbsp;&nbsp;<span id="wait_conn" style="font-size: 13px; color: #000000;"></span></div>
                    <div class="t_right link_b" style="display: block;">
                        <a href="javascript:void(0);" onclick="ShowDialog();">查看更多消息</a> 
                        <a id="loan" href="javascript:void(0);" onclick="ShowDialog2();" style="display:none;">| 贷款业务记录</a>
                        <a id="fnb" href="javascript:void(0);" onclick="ShowDialog3();"  style="display:none;">| 福农宝业务记录</a>
                    </div>
                    <div class="clear">
                    </div>
                </div>
                <div id="talk" style="width: 1022px; height: 482px;">
                    <div id="premsg" class="msg-pre" style="display: none; width: 1017px;">
                        <span>等待对方输入...</span>
                    </div>
                    <div id="tools">
                        &nbsp;按Ctrl+Enter键快捷发送
                        <div id="buttons" style="display: none;">
                            <div id="button-1" style="background: url(@Url.Content("~/Content/KF/images/part-bg-1_cn.gif")) no-repeat; background-position: 0px 0px;" title="表情">
                            </div>
                            <div id="button-2" style="background: url(@Url.Content("~/Content/KF/images/part-bg-1_cn.gif")) no-repeat; background-position: -23px 0px;" title="链接">
                            </div>
                            <div id="button-3" style="background: url(@Url.Content("~/Content/KF/images/part-bg-1_cn.gif")) no-repeat; background-position: -49px 0px;" title="图片">
                            </div>
                            <div id="button-snapshot" title="截图">
                                <img src="@Url.Content("~/Content/KF/images/mouse_up_2_cn.gif")" name="snapshot"></div>
                            <div id="button-4" style="background: url(@Url.Content("~/Content/KF/images/part-bg-1_cn.gif")) no-repeat; background-position: -155px 0px;" title="文件">
                            </div>
                            <!---->
                            <div class="button_wk5">
                                <span class="leftMove"><a href="javascript:void(0);" hidefocus="" title="点击切换消息提示方式">
                                </a></span>
                                <div id="textMove" style="padding-bottom: 3px; padding-left: 8px;">
                                    <font style='color: red;'>弹出窗口</font>
                                </div>
                                <span class="rightMove"><a href="javascript:void(0);" class="rightMove" hidefocus=""
                                    title="点击切换消息提示方式"></a></span>
                            </div>
                        </div>
                    </div>
                    <div id="input">
                        <textarea id="input1" cols="" rows="" style="width: 908px;"></textarea>
                        <div id="send">
                            <a href="#" id="send_a"
                                onmouseover="this.style.backgroundImage='url(@Url.Content("~/Content/KF/images/send2_cn.gif"))'"
                                onmouseout="this.style.backgroundImage='url(@Url.Content("~/Content/KF/images/send1_cn.gif"))'"
                                style="display: block; float: left; width: 80px; height: 40px; background: url(@Url.Content("~/Content/KF/images/send1_cn.gif"));">
                            </a>
                            <img src="@Url.Content("~/Content/KF/images/pk-but.gif")" id="pk-but" onclick="javascript:void(0);"></div>
                        <div class="clear">
                        </div>
                    </div>
                </div>
                <div id="info" style="left: 1190px; height:250px;" class="link_b3">
                    <!--<h3 class="link_b">访客信息<span class="track_view"><a href="#" onclick="lookTrace(event)">查看轨迹</a></span></h3>-->
                    <h3 class="link_b">
                        <a href="#" onclick="return false;">访客信息</a><span id="view_trace" class="look_trace"></span>
                    </h3>
                    <p id="visitor_info" style="padding:5px">  
                    </p>
                    <table width="164" border="0" cellspacing="0" cellpadding="0" align="center">
                        <tbody>
                            <tr>
                                <td width="110" height="30">
                                    <div id="v_card" class="v_card">
                                    </div>
                                </td>
                                <td width="54" height="30" align="center" id="v_editname" class="link_b2">
                                </td>
                            </tr>
                            <tr>
                                <td colspan="2">
                                    <div id="v_ip" class="v_ip" style="display: none">
                                        <a href="javascript:void(0)">添加联系人</a>
                                    </div>
                                </td>
                            </tr>
                            <tr class="quick-link">
                                <td colspan="2" height="30">
                                    <span id="v_viewcard" class="link_b2"></span>&nbsp;&nbsp;<span id="v_viewlink" class="link_b2"></span>&nbsp;&nbsp;<span
                                        id="v_addremark" class="link_b2"></span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <p>
                    </p>
                </div>
                <div id="quick" class="link_b" style="left: 1190px; top:295px; height:245px;">
                    <h3>
                        <table width="144" border="0" cellspacing="0" cellpadding="0">
                            <tbody>
                                <tr style="text-indent: 0;">
                                    <td width="64">
                                        本次摘要
                                    </td>
                                    <td width="80">
                                        <span class="common_add link_b">
                                            <img class="common_add_img" src="@Url.Content("~/Content/KF/images/add.gif")">
                                            <a href="javascript:void(0);" onclick="$('#cyy_add').show();$('#phrase_content').val($('#meetingExplain').html());"><span id="cyy_oper">编辑</span></a></span>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </h3>
                    <div id="cyy_list" style="height: 299px;">
                        <div style="padding:3px;" id="meetingExplain"></div>
                    </div>
                </div>
                <!--常用语管理-->
                <div class="cyy_add" id="cyy_add" style="display:none ; left: 1190px; top:320px; height: 210px;">
                    <!--<h3 id="cyy_oper" onclick="hideCyy()">添加</h3>-->
                    <table width="100%" border="0" cellspacing="0" cellpadding="0">
                        <tbody>
                            <tr>
                                <td height="26" align="center" valign="top">
                                    摘要:
                                </td>
                                <td>
                                    <textarea name="textarea" id="phrase_content" style="height: 120px;"></textarea>
                                </td>
                            </tr>
                            <tr>
                                <td align="center" colspan="2" class="cyy_save">
                                    <input id="btnQuickAnswer" type="button" value="保存" class="cyy_cancel" onclick="Oclient.UpdateMeetingExplain();">
                                    <input type="button" value="取消" onclick="$('#cyy_add').hide();">
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <!--发送快捷键-->
                <div id="pressdiv" style="display: none; top: 446px; left: 1181px;">
                    <div id="line1" class="pressdiv-line" onmousemove="" onmouseout="">
                        <div id="line1-left" class="pressdiv-line-left pkselect">
                        </div>
                        <div class="pressdiv-line-right text-l">
                            按Enter键发送
                        </div>
                    </div>
                    <div id="line2" class="pressdiv-line" onmousemove="" onmouseout="">
                        <div id="line2-left" class="pressdiv-line-left">
                        </div>
                        <div class="pressdiv-line-right text-l">
                            按Ctrl+Enter键发送
                        </div>
                    </div>
                </div>
                <div id="clue" style="display: none">
                </div>
                <!-- send_tips -->
                <div id="send_tips" style="display: none; top: 424px; left: 936px;">
                </div>
                <!--转接客服-->
                <div id="switch_div" class="switch_list" style="display: none; left: 1164px;">
                    <div class="switch_title" onclick="javascript:void(0);">
                        客服转接</div>
                    <div class="switch_list_top" id="switch_div_title">
                        <span>请选择要转接的客服:</span></div>
                    <div class="switch_list_main">
                        <div id="switch_staff_list" class="link_b">
                            <!--客服列表-->
                        </div>
                    </div>
                    <div class="switch_list_bottom">
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--表情-->
    <div id="face_div" style="display: none; top: 291px;">
        @*<iframe src="@Url.Content("~/Content/KF/html/fac.html")" id="iface" class="iface" frameborder="0">
        </iframe>*@
    </div>
    <!--文件  new-->
    <div id="file_div" class="file_list" style="display: none; top: 261px;">
        <div class="file_list_top" id="file_div_title">
            <img src="@Url.Content("~/Content/kf/images/file_list_close.gif")" onclick="javascript:void(0);" title="点击关闭"></div>
        <div class="file_list_main">
            <iframe id="upload_iframe" src="" class="ifile" frameborder="0"></iframe>
        </div>
    </div>
    <div id="part_3" class="part_kf" style="display: none">
        <div class="block">
            <div id="track_t" style="width: 1354px;">
                <table width="100%" border="0" cellspacing="0" cellpadding="0" align="center">
                    <tbody>
                        <tr>
                            <td width="19" class="td">
                                &nbsp;
                            </td>
                            <td width="76">
                                操作
                            </td>
                            <td width="8">
                                <img src="@Url.Content("~/Content/KF/images/fege_img.gif")">
                            </td>
                            <td width="108">
                                状态
                            </td>
                            <td width="8">
                                <img src="@Url.Content("~/Content/KF/images/fege_img.gif")">
                            </td>
                            <td>
                                访客名称
                            </td>
                            <td width="8">
                                <img src="@Url.Content("~/Content/KF/images/fege_img.gif")">
                            </td>
                            <td width="103">
                                &nbsp;
                            </td>
                            <td width="5">
                                <img src="@Url.Content("~/Content/KF/images/fege_img.gif")">
                            </td>
                            <td width="60">
                                &nbsp;
                            </td>
                            <td width="8">
                                <img src="@Url.Content("~/Content/KF/images/fege_img.gif")">
                            </td>
                            <td width="79">
                                &nbsp;
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div id="track" style="width: 1354px; height: 456px;">
                <table width="100%" border="0" cellspacing="0" cellpadding="0" align="center">
                    <tbody id="guest">
                    </tbody>
                </table>
            </div>
            <div id="select_div" style="position: absolute; left: 5px; height: 26px; z-index: 999;
                top: 499px; width: 1354px; display: none;">
                <table width="98%" height="26" border="0" cellspacing="0" cellpadding="0" align="center">
                    <tbody>
                        <tr>
                            <td>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div id="chartDiv" style="position: absolute; z-index: 999; top: 194px; left: 517px;">
    </div>
    <div id="bottom" style="top: 607px;">
        <table width="100%" border="0" align="center" cellpadding="0" cellspacing="0">
            <tbody>
                <tr>
                    <td id="visi_cnt" width="110" class="split">
                        在线访客: 0
                    </td>
                    <td id="talk_cnt" width="110" class="split">
                        当前对话: 0
                    </td>
                    <td id="wait_cnt" width="110" class="split">
                        等待咨询: 0
                    </td>
                    <td class="split">
                        <div id="company_bottom" class="company_short" title="renya" style="width: 259px;">
                            部门: @ViewBag.Department
                        </div>
                    </td>
                    <td class="split">
                        <div id="worker_bottom" class="worker_short" title="" style="width: 518px;">
                            工号: @ViewBag.KfNumber
                        </div>
                    </td>
                    <td>
                        <div id="author_bottom" class="author_short" title="" style="width: 259px;">
                            身份: @ViewBag.RoleName</div>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
    <div id="w" class="easyui-window" title="聊天记录" data-options="iconCls:'icon-save'" style="width: 900px; height: 450px; padding: 5px;" modal="true">
        <iframe id="iframe" src="" frameborder="0" scrolling="no" style="width: 100%; height: 100%;">
        </iframe>
    </div>
    <div id="w2" class="easyui-window" title="贷款业务记录" data-options="iconCls:'icon-save'" style="width: 1000px; height: 450px; padding: 5px;" modal="true">
        <iframe id="iframe2" src="" frameborder="0" scrolling="no" style="width: 100%; height: 100%;">
        </iframe>
    </div>
    <div id="w3" class="easyui-window" closed="true" title="调额申请记录" data-options="iconCls:'icon-save'" style="width: 1000px; height: 450px; padding: 5px;" modal="true">
        <iframe id="iframe3" src="" frameborder="0" scrolling="no" style="width: 100%; height: 100%;">
        </iframe>
    </div>
    <script type="text/javascript">
        communicationHash = '@ViewBag.Hash';
    </script>
    <script src="@Url.Content("~/Content/KF/javascripts/client.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Content/KF/javascripts/communication.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Content/kf/javascripts/ui.js")" type="text/javascript"></script>
    <script type="text/javascript">
        (function () {
            /**
            注册页面卸载前事件
            **/
            window.onbeforeunload = function () {
                return '确认要退出在线客服系统？将会断掉所有的会话。';
            };
            //注册关闭后事件
            window.onunload = function () {
                if (!window.globalLock) {
                    $.ajax({
                        type: "POST",
                        url: "/Service/OffLine",
                        data: "",
                        success: function (msg) {

                        }
                    });
                }
            };
            //接入数据库中与当前客服未结束的会话
            @foreach (KfMeeting kfMeeting in ViewBag.ListKfMeeting)
            {
                @:Oclient.RestoreKfMeeting("@kfMeeting.MpUserId","@kfMeeting.Id","@kfMeeting.MpUser.NickName");
            }
        })();
    </script>
</body>
</html>
