@{
    Layout = null;
    string typeid = WebHelper.GetString("type");
    string path = Ocean.Framework.Configuration.global.config.GlobalConfig.GetConfig()["ResourceDomain"];
}
<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <title>关键词回复</title>
    <link rel="stylesheet" type="text/css" href="@Url.Content("~/Content/Mpreply/css/common.css")" />
    <script type="text/javascript" src="@Url.Content("~/Content/jquery-easyui-1.3.5/jquery.min.js")"></script>
    <script type="text/javascript" src="@Url.Content("~/Content/MpMaterial/javascript/jquery.tmpl.js")"></script>
    <script type="text/javascript" src="@Url.Content("~/Content/MpMaterial/javascript/knockout.js")"></script>
    <script type="text/javascript" src="@Url.Content("~/Content/MpMaterial/javascript/knockout.mapping.js")"></script>
</head>
<body>
    <div class="col_main">
        <div class="main_hd">
            <h2>&nbsp;<span id="js_nick_name">关注时自动回复</span>&nbsp;</h2>
        </div>
        <div class="main_bd">
            <div id="msgSender">
                <div class="msg_sender" id="js_msgSender" style="">
                    <div class="tab">
                        <ul class="tab_navs">
                            <li class="tab_nav tab_text width5" data-bind="click: textClick, css: { 'selected': showItem() }"><a href="#"><i class="icon_msg_sender"></i>文字</a></li>
                            <li class="tab_nav tab_appmsg width5 no_extra" data-bind="click: loadMaterial, css: { 'selected': !showItem() }"><a href="#"><i class="icon_msg_sender"></i>图文消息</a></li>
                        </ul>
                        <div class="tab_panel">
                            <div class="tab_content" data-bind="style: { display: showItem() ? 'block' : 'none' }">
                                <div class="js_textArea inner no_extra">
                                    <div class="emotion_editor">
                                        <textarea style="width: 99%; height: 150px; margin: 0px;" id="divArea" data-bind="event: { mouseout: textchange }, value: ReplyContent"></textarea>
                                        <div class="editor_toolbar">
                                            <a href="#" class="icon_emotion emotion_switch js_switch" style="display: none;">表情</a>
                                            <p class="editor_tip js_editorTip"><em></em></p>
                                            <div class="emotion_wrp js_emotionArea">
                                                <ul class="emotions" onselectstart="return false;">
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/0.gif" data-title="微笑" style="background-position: 0px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/1.gif" data-title="撇嘴" style="background-position: -24px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/2.gif" data-title="色" style="background-position: -48px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/3.gif" data-title="发呆" style="background-position: -72px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/4.gif" data-title="得意" style="background-position: -96px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/5.gif" data-title="流泪" style="background-position: -120px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/6.gif" data-title="害羞" style="background-position: -144px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/7.gif" data-title="闭嘴" style="background-position: -168px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/8.gif" data-title="睡" style="background-position: -192px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/9.gif" data-title="大哭" style="background-position: -216px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/10.gif" data-title="尴尬" style="background-position: -240px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/11.gif" data-title="发怒" style="background-position: -264px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/12.gif" data-title="调皮" style="background-position: -288px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/13.gif" data-title="呲牙" style="background-position: -312px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/14.gif" data-title="惊讶" style="background-position: -336px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/15.gif" data-title="难过" style="background-position: -360px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/16.gif" data-title="酷" style="background-position: -384px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/17.gif" data-title="冷汗" style="background-position: -408px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/18.gif" data-title="抓狂" style="background-position: -432px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/19.gif" data-title="吐" style="background-position: -456px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/20.gif" data-title="偷笑" style="background-position: -480px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/21.gif" data-title="可爱" style="background-position: -504px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/22.gif" data-title="白眼" style="background-position: -528px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/23.gif" data-title="傲慢" style="background-position: -552px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/24.gif" data-title="饥饿" style="background-position: -576px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/25.gif" data-title="困" style="background-position: -600px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/26.gif" data-title="惊恐" style="background-position: -624px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/27.gif" data-title="流汗" style="background-position: -648px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/28.gif" data-title="憨笑" style="background-position: -672px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/29.gif" data-title="大兵" style="background-position: -696px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/30.gif" data-title="奋斗" style="background-position: -720px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/31.gif" data-title="咒骂" style="background-position: -744px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/32.gif" data-title="疑问" style="background-position: -768px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/33.gif" data-title="嘘" style="background-position: -792px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/34.gif" data-title="晕" style="background-position: -816px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/35.gif" data-title="折磨" style="background-position: -840px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/36.gif" data-title="衰" style="background-position: -864px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/37.gif" data-title="骷髅" style="background-position: -888px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/38.gif" data-title="敲打" style="background-position: -912px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/39.gif" data-title="再见" style="background-position: -936px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/40.gif" data-title="擦汗" style="background-position: -960px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/41.gif" data-title="抠鼻" style="background-position: -984px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/42.gif" data-title="鼓掌" style="background-position: -1008px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/43.gif" data-title="糗大了" style="background-position: -1032px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/44.gif" data-title="坏笑" style="background-position: -1056px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/45.gif" data-title="左哼哼" style="background-position: -1080px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/46.gif" data-title="右哼哼" style="background-position: -1104px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/47.gif" data-title="哈欠" style="background-position: -1128px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/48.gif" data-title="鄙视" style="background-position: -1152px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/49.gif" data-title="委屈" style="background-position: -1176px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/50.gif" data-title="快哭了" style="background-position: -1200px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/51.gif" data-title="阴险" style="background-position: -1224px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/52.gif" data-title="亲亲" style="background-position: -1248px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/53.gif" data-title="吓" style="background-position: -1272px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/54.gif" data-title="可怜" style="background-position: -1296px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/55.gif" data-title="菜刀" style="background-position: -1320px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/56.gif" data-title="西瓜" style="background-position: -1344px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/57.gif" data-title="啤酒" style="background-position: -1368px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/58.gif" data-title="篮球" style="background-position: -1392px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/59.gif" data-title="乒乓" style="background-position: -1416px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/60.gif" data-title="咖啡" style="background-position: -1440px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/61.gif" data-title="饭" style="background-position: -1464px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/62.gif" data-title="猪头" style="background-position: -1488px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/63.gif" data-title="玫瑰" style="background-position: -1512px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/64.gif" data-title="凋谢" style="background-position: -1536px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/65.gif" data-title="示爱" style="background-position: -1560px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/66.gif" data-title="爱心" style="background-position: -1584px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/67.gif" data-title="心碎" style="background-position: -1608px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/68.gif" data-title="蛋糕" style="background-position: -1632px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/69.gif" data-title="闪电" style="background-position: -1656px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/70.gif" data-title="炸弹" style="background-position: -1680px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/71.gif" data-title="刀" style="background-position: -1704px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/72.gif" data-title="足球" style="background-position: -1728px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/73.gif" data-title="瓢虫" style="background-position: -1752px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/74.gif" data-title="便便" style="background-position: -1776px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/75.gif" data-title="月亮" style="background-position: -1800px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/76.gif" data-title="太阳" style="background-position: -1824px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/77.gif" data-title="礼物" style="background-position: -1848px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/78.gif" data-title="拥抱" style="background-position: -1872px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/79.gif" data-title="强" style="background-position: -1896px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/80.gif" data-title="弱" style="background-position: -1920px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/81.gif" data-title="握手" style="background-position: -1944px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/82.gif" data-title="胜利" style="background-position: -1968px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/83.gif" data-title="抱拳" style="background-position: -1992px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/84.gif" data-title="勾引" style="background-position: -2016px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/85.gif" data-title="拳头" style="background-position: -2040px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/86.gif" data-title="差劲" style="background-position: -2064px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/87.gif" data-title="爱你" style="background-position: -2088px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/88.gif" data-title="NO" style="background-position: -2112px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/89.gif" data-title="OK" style="background-position: -2136px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/90.gif" data-title="爱情" style="background-position: -2160px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/91.gif" data-title="飞吻" style="background-position: -2184px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/92.gif" data-title="跳跳" style="background-position: -2208px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/93.gif" data-title="发抖" style="background-position: -2232px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/94.gif" data-title="怄火" style="background-position: -2256px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/95.gif" data-title="转圈" style="background-position: -2280px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/96.gif" data-title="磕头" style="background-position: -2304px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/97.gif" data-title="回头" style="background-position: -2328px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/98.gif" data-title="跳绳" style="background-position: -2352px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/99.gif" data-title="挥手" style="background-position: -2376px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/100.gif" data-title="激动" style="background-position: -2400px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/101.gif" data-title="街舞" style="background-position: -2424px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/102.gif" data-title="献吻" style="background-position: -2448px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/103.gif" data-title="左太极" style="background-position: -2472px 0;"></i></li>
                                                    <li class="emotions_item"><i class="js_emotion_i" data-gifurl="images/104.gif" data-title="右太极" style="background-position: -2496px 0;"></i></li>
                                                </ul>
                                                <span class="emotions_preview js_emotionPreviewArea">
                                                    <img src="images/99.gif" /></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="tab_content" data-bind="style: { display: showItem() ? 'none' : 'block' }">
                                <div class="js_appmsgArea inner ">
                                    <div id="msgSender_media_1_10" data-bind="if: oldData().MpMaterialItems">
                                        <div class="appmsg multi">
                                            <div class="appmsg_content" data-bind="foreach: oldData().MpMaterialItems">
                                                <!-- ko if: $index()==0 -->
                                                <div class="appmsg_info">
                                                    <em class="appmsg_date">2013年06月07日</em>
                                                </div>

                                                <div class="cover_appmsg_item">
                                                    <h4 class="appmsg_title"><a href="#" data-bind="text:Title"></a></h4>
                                                    <div class="appmsg_thumb_wrp">
                                                        <img data-bind="attr: { src: '@(path)'+PicUrl}" class="appmsg_thumb">
                                                    </div>
                                                </div>
                                                <!-- /ko -->
                                                <!-- ko if: $index()>0 -->
                                                <div class="appmsg_item">
                                                    <img data-bind="attr: { src: '@(path)'+PicUrl}" class="appmsg_thumb">
                                                    <h4 class="appmsg_title"><a href="#" data-bind="text:Title"></a></h4>
                                                </div>
                                                <!-- /ko -->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tool_area">
                    <span class="btn btn_default btn_input" data-bind="click: del" id="js_delete">
                        <button>删除</button></span>
                    <span class="btn btn_primary btn_input" data-bind="click: save" id="js_submit">
                        <button>保存</button></span>
                </div>
            </div>
        </div>
    </div>

    <!--图文弹出层效果-->
    <div class="dialog_wrp media" data-bind="style: { display: showDialog() ? 'block' : 'none' }" style="width: 760px; margin-left: -380px; margin-top: -314.5px;">
        <div class="dialog">
            <div class="dialog_hd">
                <h3>选择素材</h3>
                <a href="#" data-bind="click: function () { showDialog(false) }" class="icon16_opr closed pop_closed">关闭</a>
            </div>
            <div class="dialog_bd">
                <div class="dialog_media_container" style="">
                    <div class="sub_title_bar in_dialog">
                        
                    </div>
                    <div class="js_appmsg_list appmsg_list media_dialog">
                        <div class="appmsg_col">
                            <div class="inner" id="first_col"></div>
                        </div>

                        <div class="appmsg_col">
                            <div class="inner" id="second_col"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="dialog_ft">
                <span class="btn btn_primary btn_input js_btn_p" data-bind="click: selMaterial">
                    <button class="js_btn" data-index="0">确定</button></span>
                <span class="btn btn_default btn_input js_btn_p" data-bind="click: function () { showDialog(false) }">
                    <button class="js_btn" data-index="1">取消</button></span>
            </div>
        </div>
    </div>
    <script id="mptmplfirst" type="text/x-jquery-tmpl">
        <div id="appmsg${$data.Id}">
            <div class="appmsg multi">
                <div class="appmsg_content">
                    <div class="appmsg_info">
                        <em class="appmsg_date">2013年06月07日</em>
                    </div>
                    {{each(j,item) $data.MpMaterialItems}}
                                                        {{if j==0}} 
                                                <div class="cover_appmsg_item">
                                                    <h4 class="appmsg_title"><a href="#">${item.Title}</a></h4>
                                                    <div class="appmsg_thumb_wrp">
                                                        <img src="@(path)${item.PicUrl}" alt="" class="appmsg_thumb">
                                                    </div>
                                                </div>
                    {{else}}
                                                        <div class="appmsg_item">
                                                            <img src="@(path)${item.PicUrl}" alt="" class="appmsg_thumb">
                                                            <h4 class="appmsg_title"><a href="#">${item.Title}</a></h4>
                                                        </div>
                    {{/if}}
                                                      {{/each}}  
                                                
                </div>
                <div class="appmsg_mask"></div>
                <i class="icon_appmsg_selected">已选择</i>
            </div>
        </div>
    </script>
    <script id="mptmplsecond" type="text/x-jquery-tmpl" id="second_col">
        <div id="appmsg${$data.Id}">
            <div class="appmsg multi">
                <div class="appmsg_content">
                    <div class="appmsg_info">
                        <em class="appmsg_date">2013年06月07日</em>
                    </div>
                    {{each(j,item) $data.MpMaterialItems}}
                                                        {{if j==0}} 
                                                <div class="cover_appmsg_item">
                                                    <h4 class="appmsg_title"><a href="#">${item.Title}</a></h4>
                                                    <div class="appmsg_thumb_wrp">
                                                        <img src="@(path)${item.PicUrl}" alt="" class="appmsg_thumb">
                                                    </div>
                                                </div>
                    {{else}}
                                                        <div class="appmsg_item">
                                                            <img src="@(path)${item.PicUrl}" alt="" class="appmsg_thumb">
                                                            <h4 class="appmsg_title"><a href="#">${item.Title}</a></h4>
                                                        </div>
                    {{/if}}
                                                      {{/each}}  
                                                
                </div>
                <div class="appmsg_mask"></div>
                <i class="icon_appmsg_selected">已选择</i>
            </div>
        </div>
    </script>
    <div class="mask" data-bind="style: { display: showDialog() ? 'block' : 'none' }"></div>
    <div class="mask" id="loading" style="display: none;"></div>
    <div class="JS_TIPS page_tips success" id="lbzLoding" style="display: none;">
        <div class="inner">保存成功</div>
    </div>
</body>
</html>

<script type="text/javascript">
    var reply = @Html.Raw(ViewBag.strList);
    var empty = { Id: "00000000-0000-0000-0000-000000000000", MpMaterialItems: [{ Id: "00000000-0000-0000-0000-000000000000", ReplyContent: "" }], TypeName: "text", Action: '@typeid' };
    var currmaterial = null;
    function viewModel() {
        var self = this;
        self.oldData = ko.observable(reply.MpMaterial.TypeName == "news" ? reply.MpMaterial : { Id: "00000000-0000-0000-0000-000000000000", TypeName: "news", MpMaterialItems: null });
        self.textData = ko.observable(reply.MpMaterial.TypeName == "text" ? reply.MpMaterial : empty);
        self.ReplyContent=ko.observable(Komapping.hmDe(self.textData().MpMaterialItems[0].ReplyContent));
        self.textchange = function () {

        };
        self.showItem = ko.observable(reply.Id == "00000000-0000-0000-0000-000000000000" || reply.MpMaterial.TypeName == "text");
        self.showDialog = ko.observable(false);
        self.textClick = function () {
            self.showItem(true);
        };
        self.selMaterial = function () {
            if (currmaterial != null) {
                self.oldData(currmaterial);
                self.showDialog(!self.showDialog());
                self.showItem(false);
            }
        };
        self.loadMaterial = function () {
            self.showDialog(!self.showDialog());
            $.ajax({
                url: "/MpMaterial/GetMaterialData?t=" + Math.random(),
                type: "post",
                data: {},
                dataType: "json",
                success: function (json) {
                    if (json.success) {
                        var mpitems = JSON.parse(json.message);
                        var firstitems = $.grep(mpitems, function (i, value) {
                            return value % 2 == 0;
                        });
                        var seconditems = $.grep(mpitems, function (i, value) {
                            return value % 2 == 1;
                        });
                        $("#first_col").html("");
                        $("#second_col").html("");
                        $("#mptmplfirst").tmpl(firstitems).appendTo('#first_col');
                        $("#mptmplsecond").tmpl(seconditems).appendTo('#second_col');
                    } else {
                        alert('提交数据失败');
                    }
                }
            })
        };
        self.save = function () {
            reply.MpMaterial = self.showItem() ? self.textData() : self.oldData();
            if (self.showItem()) {
                var i = self.textData();
                i.MpMaterialItems[0].ReplyContent = $("#divArea").val();
                self.textData(i);
                if (reply.MpMaterial.MpMaterialItems[0].ReplyContent.length == 0 || reply.MpMaterial.MpMaterialItems[0].ReplyContent.length > 600) {
                    alert('文字必须是1到600个字');
                    return;
                }
            } else {
                if (reply.MpMaterial.Id == "00000000-0000-0000-0000-000000000000") {
                    alert('请选择素材');
                    return;
                }
            }
            $.ajax({
                url: "/MpReply/SaveReply",
                type: "post",
                data: { data: ko.toJSON(reply) },
                dataType: "json",
                success: function (json) {
                    if (json.success) {
                        window.location.reload();
                    } else {
                        alert('提交数据失败');
                    }
                }
            })

        };
        self.del = function () {
            $.ajax({
                url: "/MpReply/DelReply",
                type: "post",
                data: { id: reply.Id },
                dataType: "json",
                success: function (json) {
                    if (json.success) {
                        window.location.reload();
                    } else {
                        alert('提交数据失败');
                    }
                }
            })
        }
    }
    ko.applyBindings(new viewModel());

    $('#first_col').delegate('.appmsg', 'click', function () {
        $(".appmsg").removeClass("selected");
        $(this).addClass("selected");
        currmaterial = $.tmplItem(this).data;        
    });
    $('#second_col').delegate('.appmsg', 'click', function () {
        $(".appmsg").removeClass("selected");
        $(this).addClass("selected");
        currmaterial = $.tmplItem(this).data;        
    });
    $(document).ajaxStart(function(){
        $("#lbzLoding>.inner").html("数据处理中");
        $("#loading").show();
        $("#lbzLoding").show();
    }).ajaxSuccess(function(){
        $("#lbzLoding>.inner").html("操作成功");
        $("#loading").hide();
        $("#lbzLoding").hide(200);
    }).ajaxError(function(){
        $("#loading").hide();
        $("#lbzLoding").hide();
        alert("数据执行不成功");
    });
</script>
