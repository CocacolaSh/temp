@{
    Layout = null;
    int typeid = WebHelper.GetInt("");
    int pageid = WebHelper.GetInt("page", 1);
    string path = Ocean.Framework.Configuration.global.config.GlobalConfig.GetConfig()["ResourceDomain"];
}
@model PagedList<Ocean.Entity.MpMaterial>
<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <title>素材库首页</title>
    <link rel="stylesheet" type="text/css" href="@Url.Content("~/Content/MpMaterial/css/common.css")" />
    <link rel="stylesheet" type="text/css" href="@Url.Content("~/Content/MpMaterial/css/pagination.css")" />
    <script type="text/javascript" src="@Url.Content("~/Content/jquery-easyui-1.3.5/jquery.min.js")"></script>
    <script type="text/javascript" src="@Url.Content("~/Content/MpMaterial/javascript/jquery.tmpl.js")"></script>
</head>
<body class="zh_CN appMsgEdit">
    <div class="container" id="main">
        <div class="containerBox">
            <div class="boxHeader">
                <h2>素材管理</h2>
            </div>
            <div class="content">
                <h3 class="page-sub-hd">图文消息列表&nbsp;(共 <span class="spnCount">@(ViewBag.totalCount)</span>个)</h3>
                <div id="Pagination" class="scott"></div>
                <div class="page-bd">
                    <div class="tj msg-list">
                        <div class="b-dib vt msg-col" id="first_col">
                            <div class="tc add-access" id="addAppmsg">
                                <a class="dib vm add-btn"  href="/MpMaterial/Add?ismul=0">单图文消息</a>
                                <a class="dib vm add-btn multi-access" href="/MpMaterial/Add?ismul=1">多图文消息</a>
                            </div>
                            <script id="mptmplfirst" type="text/x-jquery-tmpl">

                                <div data-create-time="2013-09-23" data-appid="10000006" class="msg-item-wrapper">
                                    <div class="msg-item multi-msg">
                                        {{each(j,item) $data.MpMaterialItems}}
                                                        {{if j==0}} 
                                                            <div class="appmsgItem" id="appmsgItem${j}">
                                                                <p class="msg-meta">
                                                                    <span class="msg-date">${item.CreateDate}</span>
                                                                </p>
                                                                <div class="cover">
                                                                    <p style="display: none" class="default-tip">封面图片</p>
                                                                    <h4 class="msg-t"><a class="i-title" href="#">${item.Title}</a></h4>
                                                                    <img style="" class="i-img" src="@(path)/${item.PicUrl}">
                                                                </div>
                                                                {{if $data.IsMul==0}} 
                                                                <p class="msg-text">${item.Summary}</p>
                                                                {{/if}}
                                                            </div>
                                        {{else}}
                                                      <div id="appmsgItem${j}" class="rel sub-msg-item appmsgItem">
                                                          <span class="thumb">
                                                              <span style="display: none" class="default-tip">缩略图</span>
                                                              <img style="" class="i-img" src="@(path)/${item.PicUrl}">
                                                          </span>
                                                          <h4 class="msg-t"><a class="i-title" href="#">${item.Title}</a></h4>
                                                      </div>
                                        {{/if}}
                                                      {{/each}}                                          
                                    </div>
                                    <div class="msg-opr">
                                        <ul class="f0 msg-opr-list">
                                            <li class="b-dib opr-item"><a href="/MpMaterial/Add?id=${$data.Id}" class="block tc opr-btn edit-btn"><span class="th vm dib opr-icon edit-icon">编辑</span></a></li>
                                            <li class="b-dib opr-item"><a data-mid="10000006" href="javascript:;" onclick="DelMaterial('${$data.Id}')" class="block tc opr-btn del-btn"><span class="th vm dib opr-icon del-icon">删除</span></a></li>
                                        </ul>
                                    </div>
                                    <div class="msg-hover-mask"></div>
                                    <div class="msg-mask"><span class="dib msg-selected-tip"></span></div>
                                </div>

                            </script>
                        </div>

                        <div class="b-dib vt msg-col" id="second_col">
                            <script id="mptmplsecond" type="text/x-jquery-tmpl">
                                <div data-create-time="2013-05-15" class="msg-item-wrapper">
                                    <div class="msg-item multi-msg">
                                        {{each(j,item) $data.MpMaterialItems}}
                                                        {{if j==0}} 
                                                            <div class="appmsgItem" id="appmsgItem${j}">
                                                                <p class="msg-meta">
                                                                    <span class="msg-date">${item.CreateDate}</span>
                                                                </p>
                                                                <div class="cover">
                                                                    <p style="display: none" class="default-tip">封面图片</p>
                                                                    <h4 class="msg-t"><a class="i-title" href="#">${item.Title}</a></h4>
                                                                    <img style="" class="i-img" src="@(path)/${item.PicUrl}">
                                                                </div>
                                                                {{if $data.IsMul==0}} 
                                                                <p class="msg-text">${item.Summary}</p>
                                                                {{/if}}
                                                            </div>
                                        {{else}}
                                                      <div id="appmsgItem${j}" class="rel sub-msg-item appmsgItem">
                                                          <span class="thumb">
                                                              <span style="display: none" class="default-tip">缩略图</span>
                                                              <img style="" class="i-img" src="@(path)/${item.PicUrl}">
                                                          </span>
                                                          <h4 class="msg-t"><a class="i-title" href="#">${item.Title}</a></h4>
                                                      </div>
                                        {{/if}}
                                     {{/each}}         
                                    </div>

                                    <div class="msg-opr">
                                        <ul class="f0 msg-opr-list">
                                            <li class="b-dib opr-item"><a href="/MpMaterial/Add?id=${$data.Id}" class="block tc opr-btn edit-btn"><span class="th vm dib opr-icon edit-icon">编辑</span></a></li>
                                            <li class="b-dib opr-item"><a data-mid="10000018" href="javascript:;" onclick="DelMaterial('${$data.Id}')" class="block tc opr-btn del-btn"><span class="th vm dib opr-icon del-icon">删除</span></a></li>
                                        </ul>
                                    </div>
                                    <div class="msg-hover-mask"></div>
                                    <div class="msg-mask"><span class="dib msg-selected-tip"></span></div>
                                </div>

                            </script>
                        </div>
                        <div style="width: 100%; height: 0; overflow: hidden; font-size: 0;" class="b-dib"></div>
                    </div>
                </div>
            </div>

            <div class="sideBar">
                <div class="catalogList">
                    <ul>
                        <li class="selected  "><a href="javascript:;">图文消息(<label class="spnCount">@(ViewBag.totalCount)</label>)</a></li>
                    </ul>
                </div>
            </div>
            <div class="clr"></div>
        </div>
    </div>
    <div class="mask" id="loading" style="display: none;"></div>
    <div class="JS_TIPS page_tips success" id="lbzLoding" style="display: none;">
        <div class="inner">保存成功</div>
    </div>
</body>
</html>
<script type="text/javascript">
    var mpitems =@Html.Raw(ViewBag.strList);
    var firstitems = $.grep(mpitems, function (i, value) {
        return value % 2 == 0;
    });
    var seconditems = $.grep(mpitems, function (i, value) {
        return value % 2 == 1;
    });
    $("#mptmplfirst").tmpl(firstitems).appendTo('#first_col');
    $("#mptmplsecond").tmpl(seconditems).appendTo('#second_col');
    function DelMaterial(id)
    {
        if (confirm("删除素材，对应的关键词也将一起删除，确定删除吗？")) {
            $.ajax({
                url: "/MpMaterial/DeleteMaterial",
                type: "post",
                data: { id: id },
                dataType: "json",
                success: function (json) {
                    if (json.success) {
                        window.location.href = "/MpMaterial/Index";
                    } else {
                        alert('删除素材库失败');
                    }
                }
            })
        }
    }
    $(function () {
        function pageselectCallback(page_id, jq) {
            //回调函数，进一步使用请参阅说明文档
            return true;
        }
        $("#Pagination").pagination(@(ViewBag.totalCount), {          
            callback: pageselectCallback,
            prev_text: " 上一页",
            next_text: "下一页 ",
            items_per_page: 10, //每页的数据个数
            num_display_entries: 5, //两侧首尾分页条目数
            current_page: @pageid,   //当前页码
            num_edge_entries: 3, //连续分页主体部分分页条目数
            link_to:"?page=__id__"
        });
        $(document).ajaxStart(function(){
            $("#lbzLoding>.inner").html("数据处理中");
            $("#loading").show();
            $("#lbzLoding").show();
        }).ajaxSuccess(function(){
            $("#lbzLoding>.inner").html("操作成功");
            $("#loading").hide();
            $("#lbzLoding").hide(200);
        }).ajaxError(function(){
            $("#loading").hide();
            $("#lbzLoding").hide();
            alert("数据执行不成功");
        });
    });
</script>

