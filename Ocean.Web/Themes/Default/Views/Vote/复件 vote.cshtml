@{
    Layout = "../../Shared/_VoteLayout.cshtml";
}
@*<script type="text/javascript" src="@Url.PluginUrl("lottery/javascript/jQueryRotate.2.2.js")"></script>*@
@*<script type="text/javascript" src="@Url.PluginUrl("lottery/javascript/jquery.easing.min.js")"></script>*@
<style type="text/css">
body {TEXT-ALIGN: center;}
.button {
	display: inline-block;
	zoom: 1;
 *display: inline;
	vertical-align: baseline;
	margin: 0 2px;
	outline: none;
	cursor: pointer;
	text-align: center;
	text-decoration: none;
	font: 14px/100% Arial, Helvetica, sans-serif;
	padding: .5em 2em .55em;
	text-shadow: 0 1px 1px rgba(0, 0, 0, .3);
	-webkit-border-radius: .5em;
	-moz-border-radius: .5em;
	border-radius: .5em;
	-webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, .2);
	-moz-box-shadow: 0 1px 2px rgba(0, 0, 0, .2);
	box-shadow: 0 1px 2px rgba(0, 0, 0, .2);
}
.button:hover {
	text-decoration: none;
}
.button:active {
	position: relative;
	top: 1px;
}
.bigrounded {
	-webkit-border-radius: 2em;
	-moz-border-radius: 2em;
	border-radius: 2em;
}


.white {
	color: #606060;
	border: solid 1px #b7b7b7;
	background: #fff;
	background: -webkit-gradient(linear, left top, left bottom, from(#fff), to(#ededed));
	background: -moz-linear-gradient(top, #fff, #ededed);
    filter:  progid:DXImageTransform.Microsoft.gradient(startColorstr='#ffffff', endColorstr='#ededed');
 
	float: center; 
}
.white:hover {
	background: #ededed;
	background: -webkit-gradient(linear, left top, left bottom, from(#fff), to(#dcdcdc));
	background: -moz-linear-gradient(top, #fff, #dcdcdc);
 filter:  progid:DXImageTransform.Microsoft.gradient(startColorstr='#ffffff', endColorstr='#dcdcdc');
}
.white:active {
	color: #999;
	background: -webkit-gradient(linear, left top, left bottom, from(#ededed), to(#fff));
	background: -moz-linear-gradient(top, #ededed, #fff);
 filter:  progid:DXImageTransform.Microsoft.gradient(startColorstr='#ededed', endColorstr='#ffffff');
}
.content{ margin: 0 0 15px;}
.boxcontent { background-color: #FEF8B2; border-radius: 5px 5px 5px 5px; box-shadow: 0 0 6px rgba(0, 0, 0, 0.5); margin: 15px 15px 0; padding: 2px;position:relative;}

.detail_border {margin-left:auto;margin-right:auto;border:1px solid #CCC; padding:5px; text-align:center; vertical-align:middle; width:98%; height:300px;overflow: hidden;}
.details_info {padding:5px; text-align: center; width:100%; }
.divVoteItem{border:1px dashed #000; height:100%;width:80%;margin-left:auto;margin-right:auto;display:none;}
.arrow-left{margin:100px 0 0 50px ;border-width:50px; border-color:transparent green transparent transparent;  border-style:dashed solid dashed dashed; border-left:none;}
.arrow-right{margin:100px 0 0 -50px ;border-width:50px; border-color:transparent transparent transparent black;  border-style:dashed dashed dashed solid; border-right:none;}

.leftin
{
   width:300px;  
   height:200px;  
   position:absolute;  
   top:50%;  
   margin:-100px 0 0 -150px 
}
.boxcontent .left
{
float:left;
}

.boxcontent .right
{
float:right;
}
.rightin
{
float:right;
   width:300px;  
   height:200px;  
   position:absolute;  
   top:50%;  
   margin:-100px 0 0 -150px 
}

</style>


<div id="mbMain">
    <div class="frameChang">
        <span class="stitle">@ViewBag.Title</span>
    </div>
    <div id="frameRegisterMobile" class="frameLoginBox frameLoginChang">
        <section class="modBaseBox">

	        <script type="text/javascript">

	            document.addEventListener('WeixinJSBridgeReady', function onBridgeReady() {
	                window.shareData = {
	                    "timeLineLink": "http://wx.ssrcb.com/plugins/lottery?id=" + '@(WebHelper.GetGuid("Id", Guid.Empty))',
	                    "sendFriendLink": "http://wx.ssrcb.com/plugins/lottery?id=" + '@(WebHelper.GetGuid("Id", Guid.Empty))',
	                    "weiboLink": "http://wx.ssrcb.com/plugins/lottery?id=" + '@(WebHelper.GetGuid("Id", Guid.Empty))',
	                    "ImgPath": "http://wximg.ssrcb.com/mpimages/2014/09/11/5fcc7619602-128113_jpg!431x462.jpg",
	                    "tTitle": "超高中奖率！小伙伴们，到石狮农商行抽取iphone6吧！",
	                    "tContent": "小伙伴们，到石狮农商行来抽取iphone6吧！",
	                    "fTitle": "超高中奖率！小伙伴们，到石狮农商行抽取iphone6吧！",
	                    "fContent": "手快有手慢无，小伙伴们，到石狮农商行抽取iphone6吧！",
	                    "wContent": "手快有手慢无，小伙伴们，到石狮农商行抽取iphone6吧！"
	                };

	                // 发送给好友
	                WeixinJSBridge.on('menu:share:appmessage', function (argv) {
	                    WeixinJSBridge.invoke('sendAppMessage', {
	                        "img_url": window.shareData.ImgPath,
	                        "img_width": "431",
	                        "img_height": "462",
	                        "link": window.shareData.sendFriendLink,
	                        "desc": window.shareData.fContent,
	                        "title": window.shareData.fTitle
	                    }, function (res) {
	                        _report('send_msg', res.err_msg);
	                    })
	                });
	                // 分享到朋友圈
	                WeixinJSBridge.on('menu:share:timeline', function (argv) {
	                    WeixinJSBridge.invoke('shareTimeline', {
	                        "img_url": window.shareData.ImgPath,
	                        "img_width": "431",
	                        "img_height": "462",
	                        "link": window.shareData.timeLineLink,
	                        "desc": window.shareData.tContent,
	                        "title": window.shareData.tTitle
	                    }, function (res) {
	                        _report('timeline', res.err_msg);
	                    });
	                });
	                // 分享到微博

	            }, false);



	            function voteSubmit(id, index) {
	                $.messager.confirm('提示', "您确定要投票？", function (r) {
	                    if (r) {
	                        $.ajax({
	                            type: 'post',
	                            url: '/vote/Vote?baseId=@(WebHelper.GetString("Id"))&itemId=' + id + '&t=' + Math.random(),
	                            data: {},
	                            cache: false,
	                            success: function (json) {
	                                if (json.isSuccess) {
	                                    $("#VoteLink" + index).html("您已投票");
	                                    $("#VoteCount" + index).html(json.voteCount);
	                                    $.messager.confirm('提示', json.message, "info", function () { });
	                                    return false;
	                                } else {
	                                    if (json.isLogin) {
	                                        //	                                        location.href = '/login?refUrl=' + url;
	                                        window.location = json.message;
	                                    } else {
	                                        $.messager.confirm('提示', json.message, "error", function () { });
	                                    }
	                                }
	                            }
	                        });
	                    }
	                });
	            }
	            var mobileCodeEnable = false;
	            var countdown;
	            var total = 120;
	            var count = total;
	            $.ajax({
	                type: 'post',
	                url: "GetMobileCodeSeconds",
	                async: true,
	                cache: false,
	                datatype: "json",
	                data: { operateType: 2 },
	                success: function (result) {
	                    if (result.count > 0 && result.count < total) {
	                        mobileCodeEnable = false;
	                        count = result.count;
	                        countdown = setInterval(CountDown, 1000);
	                    }
	                    else {
	                        mobileCodeEnable = true;
	                    }
	                }
	            });

	            var currentShowItem = 0;
	            var totalItemCnt = 0;
	            function prevItem() {
	                $(".divVoteItem").hide();
	                currentShowItem--;
                    if(currentShowItem < 1)
                    {
                        currentShowItem = totalItemCnt;
                    }
                    $("#VoteItem" + currentShowItem).show();
	            }
	            function nextItem() {
	                $(".divVoteItem").hide();
	                currentShowItem++;
	                if (currentShowItem > totalItemCnt) {
	                    currentShowItem = 1;
	                }
	                $("#VoteItem" + currentShowItem).show();
	            }
	            $(document).ready(function (e) {
	                totalItemCnt = $(".divVoteItem").length;
	                if (totalItemCnt <= 0) {
	                    alert("本投票系统暂未开放")
	                }
	                else {
	                    var index = Math.ceil(Math.random() * totalItemCnt);
	                    var divShowItem = "#VoteItem" + index;
	                    $(divShowItem).show();
	                    currentShowItem = index;
	                    //	                    $("#VoteItem1").show();
	                    //	                    currentShowItem = 1;
	                }

	            });
            </script>
@*            <div style="width: 90%; height: 300px; margin: auto; margin-top: 10px; position: relative;">
                   <div class="out">
                    <div class="out1">
                        <img id="lotteryBtn" src="@Url.Content("~/Content/images/闽南理工联名卡/闽南理工联名卡微信1.jpg")" style="width:100%;" />
                    </div>
                    </div>
            </div>*@
            <div class="content">
    	        <div class="boxcontent" style = "margin-top: 0px;">
                    <div class="left"><div class="leftin"><p><a href="javascript:void(0);" onclick="prevItem();" class="arrow-left"></a></p> </div></div>

                    @if (ViewBag.voteItemList != null)
                    {
                        int i = 1;
                        foreach (VoteItem voteItem in ViewBag.voteItemList)
                        {
                             <div class="divVoteItem" id = "VoteItem@(i.ToString())">  
                                <div class="detail_border"><a href="#"><img src="@Url.Content("~/Content/images/"+@voteItem.ItemPic.ToString())"></a></div>
                        
                                <div class="details_info">

                                @{
                                    bool bHasVote = false;
                                    if (ViewBag.voteSubmitItemList != null)
                                    {
                                        foreach(VoteInfo voteInfo in ViewBag.voteSubmitItemList)
                                        {
                                            if(voteInfo.VoteItemID == voteItem.Id)
                                            {
                                                bHasVote = true;
                                                break;
                                            }
                                        }
                                    }
                                    if((bHasVote)){
                                        @:<p><a  id="VoteLink@(i.ToString())" href="javascript:void(0);" onclick="voteSubmit('@voteItem.Id.ToString()', '@(i.ToString())');" class="button white bigrounded">您已经投票了</a></p>
                                    }
                                    else{
                                        @:<p><a  id="VoteLink@(i.ToString())" href="javascript:void(0);" onclick="voteSubmit('@voteItem.Id.ToString()', '@(i.ToString())');" class="button white bigrounded">投TA一票</a></p>

                                    }
                                }
                                  @*<p><a  id="VoteLink@(i.ToString())" href="javascript:void(0);" onclick="voteSubmit('@voteItem.Id.ToString()', '@(i.ToString())');" class="button white bigrounded">投TA一票</a></p>*@
            	                    <ul>
                	                    <li>名称：<span>@voteItem.ItemName.ToString()</span></li>
                
                                        <li>得票数：<span id="VoteCount@(i.ToString())">@voteItem.VoteCount</span></li>
                                    </ul>
       
                                </div>
                            </div>
@*                            <div class="divVoteItem" id = "VoteItem@(i.ToString())">  
                                <div class="detail_border"><a href="#"><img src="@Url.Content("~/Content/images/" + @voteItem.ItemPic.ToString())"></a></div>
                        
                                <div class="details_info">
                        
                                  <p><a href="javascript:void(0);" onclick="voteSubmit('@voteItem.Id.ToString()', '@(i.ToString())');" class="button white bigrounded">投TA一票</a></p>
            	                    <ul>
                	                    <li>名称：<span>@voteItem.ItemName.ToString()</span></li>
                
                                        <li>得票数：<span>@voteItem.VoteCount</span></li>
                                    </ul>
       
                                </div>
                            </div>*@
                            i++;
                        }
                    }
@*        	        <div class="divVoteItem" id = "VoteItem1">  
                        <div class="detail_border"><a href="#"><img src="img12.jpg"></a></div>
                        
                        <div class="details_info">
                        
                          <p><a href=""  class="button white bigrounded">投TA一票</a></p>
            	            <ul>
                	            <li>名称：<span>闽南理工联名卡投票</span></li>
                
                                <li>得票数：<span>200</span></li>
                            </ul>
       
                        </div>
                    </div>*@
                    <div class="right"><div class="rightin"><p><a href="javascript:void(0);" onclick="nextItem();" class="arrow-right"></a></p> </div></div>
                </div>

            </div>
        </section>
    </div>
</div>